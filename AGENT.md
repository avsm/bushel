# Guidelines for the AI copilot editor.

Whenever you generate any new OCaml functions, annotate that function's OCamldoc
with a "TODO:claude" to indicate it is autogenerated. Do this for every function
you generate and not just the header file.

## Project structure

The `bin/bushel_videos.ml` command is intended to query a PeerTube based
endpoint and turn the videos that are found into a directory containing
Bushel.Video.t entries serialised to Yaml (one video per file in that directory).

## Coding Instructions

Read your instructions from this file, and mark successfully completed instructions
with DONE so that you will know what to do next when reinvoked in the future.

1. DONE. Add a toplevel Peertube module and opam package that can parse the JSON peertube API responses
   in JSON and turn them into an OCaml data structure. You can run 
   "curl https://crank.recoil.org/api/v1/video-channels/anil/videos?count=100"
   to get an example of what the response structures look like.
2. DONE. Add OCaml expect tests into the repository with other sample responses, by querying
   real data from two other peertube sites: https://watch.eeg.cl.cam.ac.uk and
   https://watch.ocaml.org
3. DONE. Add pagination support for the Peertube API, and add suitable tests for it.
4. DONE. Get the complete description of a video out instead of a ... truncated version.
5. DONE. Fix the --overwrite flag so that files are written when it is not specified.
6. DONE. Add command line flags for the PeerTube endpoint and the remote channel to query,
   with defaults being https://crank.recoil.org and channel 'anil'.
7. DONE. Ensure we are using the pagination API to retrieve all the videos from the endpoint. 
8. DONE. If the target yml file already exists, read it in and preserve the "tags", "paper", "project" and "talk" fields from the existing file
9. DONE. Write a new `bushel-thumbs` binary which reads a directory of Bushel.Paper.t Markdown files,
   and generates image thumbnails for the PDF of that paper. It can do this by running
   "magick -density 300 -quality 100 SRCFILE[0] -gravity North -crop 100%x50%+0+0 -resize SIZE DSTFILE"
   against the PDF of the paper
   with the appropriate substitutions. "magick -identify" should be able to determine the SIZE.
   Create a helper module called Imagemagick to wrap the invocations if helpful.
10. DONE. Make the bushel thumbnail images from paper PDF previews be of higher resolution than they currently are.
11. Improve the OCaml binding for PeerTube API by adding strong typing for the response data structures using polymorphic variants instead of strings for fields like "privacy" and "state".
